%script{:charset => "UTF-8", :src => "https://ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=7.0&s=1", :type => "text/javascript"}/
:javascript
	var map = null;
	var directionsManager;
	var directionsErrorEventObj;
	var directionsUpdatedEventObj; 
	$(document).ready(function() {
		GetMap();
		$('#click').click(function(e) {
			e.preventDefault();
			createDirections();
			console.log('success');
		});
	});
	function GetMap() {
		map = new Microsoft.Maps.Map(document.getElementById("mapDiv"), {
			credentials: "Aj7xOeHv3mwl4nqgF2ok_aFqUvIJGuYEdBcHreNG_jTbtW0aDuawEI-m8jsyrKpf"
		});
	}
	function createDirections() {
			if (!directionsManager) {
			Microsoft.Maps.loadModule('Microsoft.Maps.Directions', { callback: createDrivingRoute });
		} else {
			createDrivingRoute();
		}
	}
	function createDrivingRoute() {
		if (!directionsManager) {
			createDirectionsManager();
		}
		directionsManager.resetDirections();
		// Set Route Mode to driving 
		directionsManager.setRequestOptions({
			routeMode: Microsoft.Maps.Directions.RouteMode.driving ,
			distanceUnit: Microsoft.Maps.Directions.DistanceUnit.kilometers ,
			routeOptimization: Microsoft.Maps.Directions.RouteOptimization.shortestDistance
		});
		// Define Waypoints
		var agraWaypoint = new Microsoft.Maps.Directions.Waypoint({
			location: new Microsoft.Maps.Location(27.1800, 78.0200)
		});
		var delhiWaypoint = new Microsoft.Maps.Directions.Waypoint({
			location: new Microsoft.Maps.Location(28.6100, 77.2300)
		});
		// Push waypoitns to Map
		directionsManager.addWaypoint(agraWaypoint);
		directionsManager.addWaypoint(delhiWaypoint);
		// Set the element in which the itinerary will be rendered
		directionsManager.setRenderOptions({ itineraryContainer: document.getElementById('directionsItinerary') });
		//alert('Calculating directions...');
		directionsManager.calculateDirections();
	}
	function createDirectionsManager() {
		if (!directionsManager) {
			directionsManager = new Microsoft.Maps.Directions.DirectionsManager(map);
			console.log('directions manager loaded');
		}
		//alert(displayMessage);
		directionsManager.resetDirections();
		directionsErrorEventObj = Microsoft.Maps.Events.addHandler(directionsManager, 'directionsError', function(arg) { console.log(arg.message) });
		directionsUpdatedEventObj = Microsoft.Maps.Events.addHandler(directionsManager, 'directionsUpdated', function() { console.log('Directions updated') });
	}
